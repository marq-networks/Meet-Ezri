"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createHabitHandler = createHabitHandler;
exports.getHabitsHandler = getHabitsHandler;
exports.updateHabitHandler = updateHabitHandler;
exports.deleteHabitHandler = deleteHabitHandler;
exports.logHabitCompletionHandler = logHabitCompletionHandler;
exports.getUserHabitsHandler = getUserHabitsHandler;
exports.removeHabitCompletionHandler = removeHabitCompletionHandler;
const habits_service_1 = require("./habits.service");
async function createHabitHandler(request, reply) {
    try {
        const habit = await (0, habits_service_1.createHabit)(request.user.id, request.body);
        return reply.code(201).send(habit);
    }
    catch (e) {
        console.error(e);
        return reply.code(500).send({ message: "Error creating habit" });
    }
}
async function getHabitsHandler(request, reply) {
    try {
        const habits = await (0, habits_service_1.getHabits)(request.user.id);
        return reply.code(200).send(habits);
    }
    catch (e) {
        console.error(e);
        return reply.code(500).send({ message: "Error fetching habits" });
    }
}
async function updateHabitHandler(request, reply) {
    try {
        const habit = await (0, habits_service_1.updateHabit)(request.user.id, request.params.id, request.body);
        return reply.code(200).send(habit);
    }
    catch (e) {
        console.error(e);
        return reply.code(500).send({ message: "Error updating habit" });
    }
}
async function deleteHabitHandler(request, reply) {
    try {
        await (0, habits_service_1.deleteHabit)(request.user.id, request.params.id);
        return reply.code(204).send();
    }
    catch (e) {
        console.error(e);
        return reply.code(500).send({ message: "Error deleting habit" });
    }
}
async function logHabitCompletionHandler(request, reply) {
    try {
        const log = await (0, habits_service_1.logHabitCompletion)(request.user.id, request.params.id, request.body);
        return reply.code(201).send(log);
    }
    catch (e) {
        console.error(e);
        return reply.code(500).send({ message: "Error logging habit completion" });
    }
}
async function getUserHabitsHandler(request, reply) {
    try {
        const { userId } = request.params;
        const habits = await (0, habits_service_1.getHabits)(userId);
        return reply.code(200).send(habits);
    }
    catch (e) {
        console.error(e);
        return reply.code(500).send({ message: "Error fetching user habits" });
    }
}
async function removeHabitCompletionHandler(request, reply) {
    try {
        const result = await (0, habits_service_1.removeHabitCompletion)(request.user.id, request.params.id, request.query.date);
        return reply.code(200).send(result);
    }
    catch (e) {
        console.error(e);
        return reply.code(500).send({ message: "Error removing habit completion" });
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvU2FpZiBBbGkvRG9jdW1lbnRzL0dpdEh1Yi9NZWV0RXpyaS9hcHBzL2FwaS9zcmMvbW9kdWxlcy9oYWJpdHMvaGFiaXRzLmNvbnRyb2xsZXIudHMiLCJzb3VyY2VzIjpbIkM6L1VzZXJzL1NhaWYgQWxpL0RvY3VtZW50cy9HaXRIdWIvTWVldEV6cmkvYXBwcy9hcGkvc3JjL21vZHVsZXMvaGFiaXRzL2hhYml0cy5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEsZ0RBYUM7QUFFRCw0Q0FXQztBQUVELGdEQWNDO0FBRUQsZ0RBYUM7QUFFRCw4REFjQztBQUVELG9EQVlDO0FBRUQsb0VBY0M7QUF6R0QscURBQStIO0FBRXhILEtBQUssVUFBVSxrQkFBa0IsQ0FDdEMsT0FFRSxFQUNGLEtBQW1CO0lBRW5CLElBQUksQ0FBQztRQUNILE1BQU0sS0FBSyxHQUFHLE1BQU0sSUFBQSw0QkFBVyxFQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvRCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ1gsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLENBQUMsQ0FBQztJQUNuRSxDQUFDO0FBQ0gsQ0FBQztBQUVNLEtBQUssVUFBVSxnQkFBZ0IsQ0FDcEMsT0FBdUIsRUFDdkIsS0FBbUI7SUFFbkIsSUFBSSxDQUFDO1FBQ0gsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLDBCQUFTLEVBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNoRCxP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QztJQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDWCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7QUFDSCxDQUFDO0FBRU0sS0FBSyxVQUFVLDRCQUE0QixDQUNoRCxPQUdFLEVBQ0YsS0FBbUI7SUFFbkIsSUFBSSxDQUFDO1FBQ0gsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLHNDQUFxQixFQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkcsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztRQUNYLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakIsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxpQ0FBaUMsRUFBRSxDQUFDLENBQUM7SUFDOUUsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGYXN0aWZ5UmVwbHksIEZhc3RpZnlSZXF1ZXN0IH0gZnJvbSBcImZhc3RpZnlcIjtcbmltcG9ydCB7IENyZWF0ZUhhYml0SW5wdXQsIFVwZGF0ZUhhYml0SW5wdXQsIExvZ0hhYml0SW5wdXQgfSBmcm9tIFwiLi9oYWJpdHMuc2NoZW1hXCI7XG5pbXBvcnQgeyBjcmVhdGVIYWJpdCwgZ2V0SGFiaXRzLCB1cGRhdGVIYWJpdCwgZGVsZXRlSGFiaXQsIGxvZ0hhYml0Q29tcGxldGlvbiwgcmVtb3ZlSGFiaXRDb21wbGV0aW9uIH0gZnJvbSBcIi4vaGFiaXRzLnNlcnZpY2VcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUhhYml0SGFuZGxlcihcbiAgcmVxdWVzdDogRmFzdGlmeVJlcXVlc3Q8e1xuICAgIEJvZHk6IENyZWF0ZUhhYml0SW5wdXQ7XG4gIH0+LFxuICByZXBseTogRmFzdGlmeVJlcGx5XG4pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBoYWJpdCA9IGF3YWl0IGNyZWF0ZUhhYml0KHJlcXVlc3QudXNlci5pZCwgcmVxdWVzdC5ib2R5KTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSgyMDEpLnNlbmQoaGFiaXQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihlKTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSg1MDApLnNlbmQoeyBtZXNzYWdlOiBcIkVycm9yIGNyZWF0aW5nIGhhYml0XCIgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEhhYml0c0hhbmRsZXIoXG4gIHJlcXVlc3Q6IEZhc3RpZnlSZXF1ZXN0LFxuICByZXBseTogRmFzdGlmeVJlcGx5XG4pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBoYWJpdHMgPSBhd2FpdCBnZXRIYWJpdHMocmVxdWVzdC51c2VyLmlkKTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSgyMDApLnNlbmQoaGFiaXRzKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgcmV0dXJuIHJlcGx5LmNvZGUoNTAwKS5zZW5kKHsgbWVzc2FnZTogXCJFcnJvciBmZXRjaGluZyBoYWJpdHNcIiB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlSGFiaXRIYW5kbGVyKFxuICByZXF1ZXN0OiBGYXN0aWZ5UmVxdWVzdDx7XG4gICAgUGFyYW1zOiB7IGlkOiBzdHJpbmcgfTtcbiAgICBCb2R5OiBVcGRhdGVIYWJpdElucHV0O1xuICB9PixcbiAgcmVwbHk6IEZhc3RpZnlSZXBseVxuKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgaGFiaXQgPSBhd2FpdCB1cGRhdGVIYWJpdChyZXF1ZXN0LnVzZXIuaWQsIHJlcXVlc3QucGFyYW1zLmlkLCByZXF1ZXN0LmJvZHkpO1xuICAgIHJldHVybiByZXBseS5jb2RlKDIwMCkuc2VuZChoYWJpdCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgIHJldHVybiByZXBseS5jb2RlKDUwMCkuc2VuZCh7IG1lc3NhZ2U6IFwiRXJyb3IgdXBkYXRpbmcgaGFiaXRcIiB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlSGFiaXRIYW5kbGVyKFxuICByZXF1ZXN0OiBGYXN0aWZ5UmVxdWVzdDx7XG4gICAgUGFyYW1zOiB7IGlkOiBzdHJpbmcgfTtcbiAgfT4sXG4gIHJlcGx5OiBGYXN0aWZ5UmVwbHlcbikge1xuICB0cnkge1xuICAgIGF3YWl0IGRlbGV0ZUhhYml0KHJlcXVlc3QudXNlci5pZCwgcmVxdWVzdC5wYXJhbXMuaWQpO1xuICAgIHJldHVybiByZXBseS5jb2RlKDIwNCkuc2VuZCgpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihlKTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSg1MDApLnNlbmQoeyBtZXNzYWdlOiBcIkVycm9yIGRlbGV0aW5nIGhhYml0XCIgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ0hhYml0Q29tcGxldGlvbkhhbmRsZXIoXG4gIHJlcXVlc3Q6IEZhc3RpZnlSZXF1ZXN0PHtcbiAgICBQYXJhbXM6IHsgaWQ6IHN0cmluZyB9O1xuICAgIEJvZHk6IExvZ0hhYml0SW5wdXQ7XG4gIH0+LFxuICByZXBseTogRmFzdGlmeVJlcGx5XG4pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBsb2cgPSBhd2FpdCBsb2dIYWJpdENvbXBsZXRpb24ocmVxdWVzdC51c2VyLmlkLCByZXF1ZXN0LnBhcmFtcy5pZCwgcmVxdWVzdC5ib2R5KTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSgyMDEpLnNlbmQobG9nKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgcmV0dXJuIHJlcGx5LmNvZGUoNTAwKS5zZW5kKHsgbWVzc2FnZTogXCJFcnJvciBsb2dnaW5nIGhhYml0IGNvbXBsZXRpb25cIiB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckhhYml0c0hhbmRsZXIoXG4gIHJlcXVlc3Q6IEZhc3RpZnlSZXF1ZXN0PHsgUGFyYW1zOiB7IHVzZXJJZDogc3RyaW5nIH0gfT4sXG4gIHJlcGx5OiBGYXN0aWZ5UmVwbHlcbikge1xuICB0cnkge1xuICAgIGNvbnN0IHsgdXNlcklkIH0gPSByZXF1ZXN0LnBhcmFtcztcbiAgICBjb25zdCBoYWJpdHMgPSBhd2FpdCBnZXRIYWJpdHModXNlcklkKTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSgyMDApLnNlbmQoaGFiaXRzKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgcmV0dXJuIHJlcGx5LmNvZGUoNTAwKS5zZW5kKHsgbWVzc2FnZTogXCJFcnJvciBmZXRjaGluZyB1c2VyIGhhYml0c1wiIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW1vdmVIYWJpdENvbXBsZXRpb25IYW5kbGVyKFxuICByZXF1ZXN0OiBGYXN0aWZ5UmVxdWVzdDx7XG4gICAgUGFyYW1zOiB7IGlkOiBzdHJpbmcgfTtcbiAgICBRdWVyeXN0cmluZzogeyBkYXRlOiBzdHJpbmcgfTtcbiAgfT4sXG4gIHJlcGx5OiBGYXN0aWZ5UmVwbHlcbikge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlbW92ZUhhYml0Q29tcGxldGlvbihyZXF1ZXN0LnVzZXIuaWQsIHJlcXVlc3QucGFyYW1zLmlkLCByZXF1ZXN0LnF1ZXJ5LmRhdGUpO1xuICAgIHJldHVybiByZXBseS5jb2RlKDIwMCkuc2VuZChyZXN1bHQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihlKTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSg1MDApLnNlbmQoeyBtZXNzYWdlOiBcIkVycm9yIHJlbW92aW5nIGhhYml0IGNvbXBsZXRpb25cIiB9KTtcbiAgfVxufVxuIl19