"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createSleepEntryHandler = createSleepEntryHandler;
exports.getSleepEntriesHandler = getSleepEntriesHandler;
exports.getSleepEntryByIdHandler = getSleepEntryByIdHandler;
exports.updateSleepEntryHandler = updateSleepEntryHandler;
exports.getUserSleepEntriesHandler = getUserSleepEntriesHandler;
exports.deleteSleepEntryHandler = deleteSleepEntryHandler;
const sleep_service_1 = require("./sleep.service");
async function createSleepEntryHandler(request, reply) {
    const userId = request.user.id;
    const entry = await (0, sleep_service_1.createSleepEntry)(userId, request.body);
    return reply.code(201).send(entry);
}
async function getSleepEntriesHandler(request, reply) {
    const userId = request.user.id;
    const entries = await (0, sleep_service_1.getSleepEntries)(userId);
    return reply.send(entries);
}
async function getSleepEntryByIdHandler(request, reply) {
    const userId = request.user.id;
    const entry = await (0, sleep_service_1.getSleepEntryById)(userId, request.params.id);
    if (!entry) {
        return reply.code(404).send({ message: 'Sleep entry not found' });
    }
    if (entry.user_id !== userId) {
        return reply.code(403).send({ message: 'Unauthorized' });
    }
    return reply.send(entry);
}
async function updateSleepEntryHandler(request, reply) {
    const userId = request.user.id;
    try {
        const entry = await (0, sleep_service_1.updateSleepEntry)(userId, request.params.id, request.body);
        return reply.send(entry);
    }
    catch (error) {
        return reply.code(404).send({ message: 'Sleep entry not found' });
    }
}
async function getUserSleepEntriesHandler(request, reply) {
    const { userId } = request.params;
    const entries = await (0, sleep_service_1.getSleepEntries)(userId);
    return reply.send(entries);
}
async function deleteSleepEntryHandler(request, reply) {
    const userId = request.user.id;
    try {
        await (0, sleep_service_1.deleteSleepEntry)(userId, request.params.id);
        return reply.code(204).send();
    }
    catch (error) {
        return reply.code(404).send({ message: 'Sleep entry not found' });
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvU2FpZiBBbGkvRG9jdW1lbnRzL0dpdEh1Yi9NZWV0RXpyaS9hcHBzL2FwaS9zcmMvbW9kdWxlcy9zbGVlcC9zbGVlcC5jb250cm9sbGVyLnRzIiwic291cmNlcyI6WyJDOi9Vc2Vycy9TYWlmIEFsaS9Eb2N1bWVudHMvR2l0SHViL01lZXRFenJpL2FwcHMvYXBpL3NyYy9tb2R1bGVzL3NsZWVwL3NsZWVwLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSwwREFPQztBQUVELHdEQU9DO0FBRUQsNERBYUM7QUFFRCwwREFXQztBQUVELGdFQU9DO0FBRUQsMERBV0M7QUFyRUQsbURBQTJIO0FBR3BILEtBQUssVUFBVSx1QkFBdUIsQ0FDM0MsT0FBd0QsRUFDeEQsS0FBbUI7SUFFbkIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDL0IsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFBLGdDQUFnQixFQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0QsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNyQyxDQUFDO0FBRU0sS0FBSyxVQUFVLHNCQUFzQixDQUMxQyxPQUF1QixFQUN2QixLQUFtQjtJQUVuQixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUMvQixNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUEsK0JBQWUsRUFBQyxNQUFNLENBQUMsQ0FBQztJQUM5QyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDN0IsQ0FBQztBQUVNLEtBQUssVUFBVSx3QkFBd0IsQ0FDNUMsT0FBbUQsRUFDbkQsS0FBbUI7SUFFbkIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDL0IsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFBLGlDQUFpQixFQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2pFLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNYLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFDRCxJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssTUFBTSxFQUFFLENBQUM7UUFDN0IsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFDRCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDM0IsQ0FBQztBQUVNLEtBQUssVUFBVSx1QkFBdUIsQ0FDM0MsT0FBZ0YsRUFDaEYsS0FBbUI7SUFFbkIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDL0IsSUFBSSxDQUFDO1FBQ0gsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFBLGdDQUFnQixFQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUUsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxDQUFDLENBQUM7SUFDcEUsQ0FBQztBQUNILENBQUM7QUFFTSxLQUFLLFVBQVUsMEJBQTBCLENBQzlDLE9BQXVELEVBQ3ZELEtBQW1CO0lBRW5CLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO0lBQ2xDLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBQSwrQkFBZSxFQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzlDLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM3QixDQUFDO0FBRU0sS0FBSyxVQUFVLHVCQUF1QixDQUMzQyxPQUFtRCxFQUNuRCxLQUFtQjtJQUVuQixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUMvQixJQUFJLENBQUM7UUFDSCxNQUFNLElBQUEsZ0NBQWdCLEVBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEQsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxDQUFDLENBQUM7SUFDcEUsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGYXN0aWZ5UmVwbHksIEZhc3RpZnlSZXF1ZXN0IH0gZnJvbSAnZmFzdGlmeSc7XG5pbXBvcnQgeyBjcmVhdGVTbGVlcEVudHJ5LCBkZWxldGVTbGVlcEVudHJ5LCBnZXRTbGVlcEVudHJpZXMsIGdldFNsZWVwRW50cnlCeUlkLCB1cGRhdGVTbGVlcEVudHJ5IH0gZnJvbSAnLi9zbGVlcC5zZXJ2aWNlJztcbmltcG9ydCB7IENyZWF0ZVNsZWVwRW50cnlJbnB1dCwgVXBkYXRlU2xlZXBFbnRyeUlucHV0IH0gZnJvbSAnLi9zbGVlcC5zY2hlbWEnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2xlZXBFbnRyeUhhbmRsZXIoXG4gIHJlcXVlc3Q6IEZhc3RpZnlSZXF1ZXN0PHsgQm9keTogQ3JlYXRlU2xlZXBFbnRyeUlucHV0IH0+LFxuICByZXBseTogRmFzdGlmeVJlcGx5XG4pIHtcbiAgY29uc3QgdXNlcklkID0gcmVxdWVzdC51c2VyLmlkO1xuICBjb25zdCBlbnRyeSA9IGF3YWl0IGNyZWF0ZVNsZWVwRW50cnkodXNlcklkLCByZXF1ZXN0LmJvZHkpO1xuICByZXR1cm4gcmVwbHkuY29kZSgyMDEpLnNlbmQoZW50cnkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2xlZXBFbnRyaWVzSGFuZGxlcihcbiAgcmVxdWVzdDogRmFzdGlmeVJlcXVlc3QsXG4gIHJlcGx5OiBGYXN0aWZ5UmVwbHlcbikge1xuICBjb25zdCB1c2VySWQgPSByZXF1ZXN0LnVzZXIuaWQ7XG4gIGNvbnN0IGVudHJpZXMgPSBhd2FpdCBnZXRTbGVlcEVudHJpZXModXNlcklkKTtcbiAgcmV0dXJuIHJlcGx5LnNlbmQoZW50cmllcyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTbGVlcEVudHJ5QnlJZEhhbmRsZXIoXG4gIHJlcXVlc3Q6IEZhc3RpZnlSZXF1ZXN0PHsgUGFyYW1zOiB7IGlkOiBzdHJpbmcgfSB9PixcbiAgcmVwbHk6IEZhc3RpZnlSZXBseVxuKSB7XG4gIGNvbnN0IHVzZXJJZCA9IHJlcXVlc3QudXNlci5pZDtcbiAgY29uc3QgZW50cnkgPSBhd2FpdCBnZXRTbGVlcEVudHJ5QnlJZCh1c2VySWQsIHJlcXVlc3QucGFyYW1zLmlkKTtcbiAgaWYgKCFlbnRyeSkge1xuICAgIHJldHVybiByZXBseS5jb2RlKDQwNCkuc2VuZCh7IG1lc3NhZ2U6ICdTbGVlcCBlbnRyeSBub3QgZm91bmQnIH0pO1xuICB9XG4gIGlmIChlbnRyeS51c2VyX2lkICE9PSB1c2VySWQpIHtcbiAgICByZXR1cm4gcmVwbHkuY29kZSg0MDMpLnNlbmQoeyBtZXNzYWdlOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgfVxuICByZXR1cm4gcmVwbHkuc2VuZChlbnRyeSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVTbGVlcEVudHJ5SGFuZGxlcihcbiAgcmVxdWVzdDogRmFzdGlmeVJlcXVlc3Q8eyBQYXJhbXM6IHsgaWQ6IHN0cmluZyB9OyBCb2R5OiBVcGRhdGVTbGVlcEVudHJ5SW5wdXQgfT4sXG4gIHJlcGx5OiBGYXN0aWZ5UmVwbHlcbikge1xuICBjb25zdCB1c2VySWQgPSByZXF1ZXN0LnVzZXIuaWQ7XG4gIHRyeSB7XG4gICAgY29uc3QgZW50cnkgPSBhd2FpdCB1cGRhdGVTbGVlcEVudHJ5KHVzZXJJZCwgcmVxdWVzdC5wYXJhbXMuaWQsIHJlcXVlc3QuYm9keSk7XG4gICAgcmV0dXJuIHJlcGx5LnNlbmQoZW50cnkpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiByZXBseS5jb2RlKDQwNCkuc2VuZCh7IG1lc3NhZ2U6ICdTbGVlcCBlbnRyeSBub3QgZm91bmQnIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyU2xlZXBFbnRyaWVzSGFuZGxlcihcbiAgcmVxdWVzdDogRmFzdGlmeVJlcXVlc3Q8eyBQYXJhbXM6IHsgdXNlcklkOiBzdHJpbmcgfSB9PixcbiAgcmVwbHk6IEZhc3RpZnlSZXBseVxuKSB7XG4gIGNvbnN0IHsgdXNlcklkIH0gPSByZXF1ZXN0LnBhcmFtcztcbiAgY29uc3QgZW50cmllcyA9IGF3YWl0IGdldFNsZWVwRW50cmllcyh1c2VySWQpO1xuICByZXR1cm4gcmVwbHkuc2VuZChlbnRyaWVzKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVNsZWVwRW50cnlIYW5kbGVyKFxuICByZXF1ZXN0OiBGYXN0aWZ5UmVxdWVzdDx7IFBhcmFtczogeyBpZDogc3RyaW5nIH0gfT4sXG4gIHJlcGx5OiBGYXN0aWZ5UmVwbHlcbikge1xuICBjb25zdCB1c2VySWQgPSByZXF1ZXN0LnVzZXIuaWQ7XG4gIHRyeSB7XG4gICAgYXdhaXQgZGVsZXRlU2xlZXBFbnRyeSh1c2VySWQsIHJlcXVlc3QucGFyYW1zLmlkKTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSgyMDQpLnNlbmQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gcmVwbHkuY29kZSg0MDQpLnNlbmQoeyBtZXNzYWdlOiAnU2xlZXAgZW50cnkgbm90IGZvdW5kJyB9KTtcbiAgfVxufVxuIl19