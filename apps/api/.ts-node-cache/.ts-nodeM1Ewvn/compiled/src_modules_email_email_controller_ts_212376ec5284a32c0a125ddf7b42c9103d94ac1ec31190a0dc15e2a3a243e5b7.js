"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sendEmailHandler = sendEmailHandler;
const email_service_1 = require("./email.service");
const email_schema_1 = require("./email.schema");
async function sendEmailHandler(request, reply) {
    try {
        // Manual validation
        const body = email_schema_1.sendEmailSchema.parse(request.body);
        const { to, subject, html, text } = body;
        const info = await email_service_1.emailService.sendEmail(to, subject, html, text);
        return reply.code(200).send({ success: true, messageId: info.messageId });
    }
    catch (error) {
        if (error.name === 'ZodError') {
            return reply.code(400).send({
                statusCode: 400,
                error: 'Bad Request',
                message: 'Validation failed',
                details: error.errors
            });
        }
        request.log.error({ error }, 'Failed to send email');
        return reply.code(500).send({ message: 'Failed to send email', error: error.message });
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvU2FpZiBBbGkvRG9jdW1lbnRzL0dpdEh1Yi9NZWV0RXpyaS9hcHBzL2FwaS9zcmMvbW9kdWxlcy9lbWFpbC9lbWFpbC5jb250cm9sbGVyLnRzIiwic291cmNlcyI6WyJDOi9Vc2Vycy9TYWlmIEFsaS9Eb2N1bWVudHMvR2l0SHViL01lZXRFenJpL2FwcHMvYXBpL3NyYy9tb2R1bGVzL2VtYWlsL2VtYWlsLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSw0Q0F3QkM7QUEzQkQsbURBQStDO0FBQy9DLGlEQUFpRTtBQUUxRCxLQUFLLFVBQVUsZ0JBQWdCLENBQ3BDLE9BQWlELEVBQ2pELEtBQW1CO0lBRW5CLElBQUksQ0FBQztRQUNILG9CQUFvQjtRQUNwQixNQUFNLElBQUksR0FBRyw4QkFBZSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakQsTUFBTSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQztRQUV6QyxNQUFNLElBQUksR0FBRyxNQUFNLDRCQUFZLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ25FLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztRQUNwQixJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssVUFBVSxFQUFFLENBQUM7WUFDOUIsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDMUIsVUFBVSxFQUFFLEdBQUc7Z0JBQ2YsS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLE9BQU8sRUFBRSxtQkFBbUI7Z0JBQzVCLE9BQU8sRUFBRSxLQUFLLENBQUMsTUFBTTthQUN0QixDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO1FBQ3JELE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQ3pGLENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmFzdGlmeVJlcGx5LCBGYXN0aWZ5UmVxdWVzdCB9IGZyb20gJ2Zhc3RpZnknO1xuaW1wb3J0IHsgZW1haWxTZXJ2aWNlIH0gZnJvbSAnLi9lbWFpbC5zZXJ2aWNlJztcbmltcG9ydCB7IHNlbmRFbWFpbFNjaGVtYSwgU2VuZEVtYWlsSW5wdXQgfSBmcm9tICcuL2VtYWlsLnNjaGVtYSc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kRW1haWxIYW5kbGVyKFxuICByZXF1ZXN0OiBGYXN0aWZ5UmVxdWVzdDx7IEJvZHk6IFNlbmRFbWFpbElucHV0IH0+LFxuICByZXBseTogRmFzdGlmeVJlcGx5XG4pIHtcbiAgdHJ5IHtcbiAgICAvLyBNYW51YWwgdmFsaWRhdGlvblxuICAgIGNvbnN0IGJvZHkgPSBzZW5kRW1haWxTY2hlbWEucGFyc2UocmVxdWVzdC5ib2R5KTtcbiAgICBjb25zdCB7IHRvLCBzdWJqZWN0LCBodG1sLCB0ZXh0IH0gPSBib2R5O1xuXG4gICAgY29uc3QgaW5mbyA9IGF3YWl0IGVtYWlsU2VydmljZS5zZW5kRW1haWwodG8sIHN1YmplY3QsIGh0bWwsIHRleHQpO1xuICAgIHJldHVybiByZXBseS5jb2RlKDIwMCkuc2VuZCh7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2VJZDogaW5mby5tZXNzYWdlSWQgfSk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1pvZEVycm9yJykge1xuICAgICAgcmV0dXJuIHJlcGx5LmNvZGUoNDAwKS5zZW5kKHsgXG4gICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgICAgZXJyb3I6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgIGRldGFpbHM6IGVycm9yLmVycm9ycyBcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXF1ZXN0LmxvZy5lcnJvcih7IGVycm9yIH0sICdGYWlsZWQgdG8gc2VuZCBlbWFpbCcpO1xuICAgIHJldHVybiByZXBseS5jb2RlKDUwMCkuc2VuZCh7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2VuZCBlbWFpbCcsIGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xuICB9XG59XG4iXX0=