"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getContactsHandler = getContactsHandler;
exports.createContactHandler = createContactHandler;
exports.updateContactHandler = updateContactHandler;
exports.deleteContactHandler = deleteContactHandler;
const emergency_contacts_service_1 = require("./emergency-contacts.service");
async function getContactsHandler(request, reply) {
    const user = request.user;
    const contacts = await (0, emergency_contacts_service_1.getEmergencyContacts)(user.sub);
    return reply.code(200).send(contacts);
}
async function createContactHandler(request, reply) {
    const user = request.user;
    const contact = await (0, emergency_contacts_service_1.createEmergencyContact)(user.sub, request.body);
    return reply.code(201).send(contact);
}
async function updateContactHandler(request, reply) {
    const user = request.user;
    const { id } = request.params;
    try {
        const contact = await (0, emergency_contacts_service_1.updateEmergencyContact)(user.sub, id, request.body);
        return reply.code(200).send(contact);
    }
    catch (error) {
        return reply.code(404).send({ message: 'Contact not found' });
    }
}
async function deleteContactHandler(request, reply) {
    const user = request.user;
    const { id } = request.params;
    try {
        await (0, emergency_contacts_service_1.deleteEmergencyContact)(user.sub, id);
        return reply.code(204).send();
    }
    catch (error) {
        return reply.code(404).send({ message: 'Contact not found' });
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvU2FpZiBBbGkvRG9jdW1lbnRzL0dpdEh1Yi9NZWV0RXpyaS9hcHBzL2FwaS9zcmMvbW9kdWxlcy91c2Vycy9lbWVyZ2VuY3ktY29udGFjdHMuY29udHJvbGxlci50cyIsInNvdXJjZXMiOlsiQzovVXNlcnMvU2FpZiBBbGkvRG9jdW1lbnRzL0dpdEh1Yi9NZWV0RXpyaS9hcHBzL2FwaS9zcmMvbW9kdWxlcy91c2Vycy9lbWVyZ2VuY3ktY29udGFjdHMuY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUlBLGdEQU9DO0FBRUQsb0RBT0M7QUFFRCxvREFZQztBQUVELG9EQVlDO0FBOUNELDZFQUE0STtBQUVySSxLQUFLLFVBQVUsa0JBQWtCLENBQ3RDLE9BQXVCLEVBQ3ZCLEtBQW1CO0lBRW5CLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUF1QixDQUFDO0lBQzdDLE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBQSxpREFBb0IsRUFBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdEQsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN4QyxDQUFDO0FBRU0sS0FBSyxVQUFVLG9CQUFvQixDQUN4QyxPQUE4RCxFQUM5RCxLQUFtQjtJQUVuQixNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsSUFBdUIsQ0FBQztJQUM3QyxNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUEsbURBQXNCLEVBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDckUsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBRU0sS0FBSyxVQUFVLG9CQUFvQixDQUN4QyxPQUFzRixFQUN0RixLQUFtQjtJQUVuQixNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsSUFBdUIsQ0FBQztJQUM3QyxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUM5QixJQUFJLENBQUM7UUFDSCxNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUEsbURBQXNCLEVBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pFLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLENBQUMsQ0FBQztJQUNoRSxDQUFDO0FBQ0gsQ0FBQztBQUVNLEtBQUssVUFBVSxvQkFBb0IsQ0FDeEMsT0FBbUQsRUFDbkQsS0FBbUI7SUFFbkIsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQXVCLENBQUM7SUFDN0MsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7SUFDOUIsSUFBSSxDQUFDO1FBQ0gsTUFBTSxJQUFBLG1EQUFzQixFQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDM0MsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxDQUFDLENBQUM7SUFDaEUsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGYXN0aWZ5UmVwbHksIEZhc3RpZnlSZXF1ZXN0IH0gZnJvbSAnZmFzdGlmeSc7XG5pbXBvcnQgeyBDcmVhdGVFbWVyZ2VuY3lDb250YWN0SW5wdXQsIFVwZGF0ZUVtZXJnZW5jeUNvbnRhY3RJbnB1dCB9IGZyb20gJy4vZW1lcmdlbmN5LWNvbnRhY3RzLnNjaGVtYSc7XG5pbXBvcnQgeyBnZXRFbWVyZ2VuY3lDb250YWN0cywgY3JlYXRlRW1lcmdlbmN5Q29udGFjdCwgdXBkYXRlRW1lcmdlbmN5Q29udGFjdCwgZGVsZXRlRW1lcmdlbmN5Q29udGFjdCB9IGZyb20gJy4vZW1lcmdlbmN5LWNvbnRhY3RzLnNlcnZpY2UnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNIYW5kbGVyKFxuICByZXF1ZXN0OiBGYXN0aWZ5UmVxdWVzdCxcbiAgcmVwbHk6IEZhc3RpZnlSZXBseVxuKSB7XG4gIGNvbnN0IHVzZXIgPSByZXF1ZXN0LnVzZXIgYXMgeyBzdWI6IHN0cmluZyB9O1xuICBjb25zdCBjb250YWN0cyA9IGF3YWl0IGdldEVtZXJnZW5jeUNvbnRhY3RzKHVzZXIuc3ViKTtcbiAgcmV0dXJuIHJlcGx5LmNvZGUoMjAwKS5zZW5kKGNvbnRhY3RzKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRhY3RIYW5kbGVyKFxuICByZXF1ZXN0OiBGYXN0aWZ5UmVxdWVzdDx7IEJvZHk6IENyZWF0ZUVtZXJnZW5jeUNvbnRhY3RJbnB1dCB9PixcbiAgcmVwbHk6IEZhc3RpZnlSZXBseVxuKSB7XG4gIGNvbnN0IHVzZXIgPSByZXF1ZXN0LnVzZXIgYXMgeyBzdWI6IHN0cmluZyB9O1xuICBjb25zdCBjb250YWN0ID0gYXdhaXQgY3JlYXRlRW1lcmdlbmN5Q29udGFjdCh1c2VyLnN1YiwgcmVxdWVzdC5ib2R5KTtcbiAgcmV0dXJuIHJlcGx5LmNvZGUoMjAxKS5zZW5kKGNvbnRhY3QpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQ29udGFjdEhhbmRsZXIoXG4gIHJlcXVlc3Q6IEZhc3RpZnlSZXF1ZXN0PHsgUGFyYW1zOiB7IGlkOiBzdHJpbmcgfTsgQm9keTogVXBkYXRlRW1lcmdlbmN5Q29udGFjdElucHV0IH0+LFxuICByZXBseTogRmFzdGlmeVJlcGx5XG4pIHtcbiAgY29uc3QgdXNlciA9IHJlcXVlc3QudXNlciBhcyB7IHN1Yjogc3RyaW5nIH07XG4gIGNvbnN0IHsgaWQgfSA9IHJlcXVlc3QucGFyYW1zO1xuICB0cnkge1xuICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCB1cGRhdGVFbWVyZ2VuY3lDb250YWN0KHVzZXIuc3ViLCBpZCwgcmVxdWVzdC5ib2R5KTtcbiAgICByZXR1cm4gcmVwbHkuY29kZSgyMDApLnNlbmQoY29udGFjdCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHJlcGx5LmNvZGUoNDA0KS5zZW5kKHsgbWVzc2FnZTogJ0NvbnRhY3Qgbm90IGZvdW5kJyB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlQ29udGFjdEhhbmRsZXIoXG4gIHJlcXVlc3Q6IEZhc3RpZnlSZXF1ZXN0PHsgUGFyYW1zOiB7IGlkOiBzdHJpbmcgfSB9PixcbiAgcmVwbHk6IEZhc3RpZnlSZXBseVxuKSB7XG4gIGNvbnN0IHVzZXIgPSByZXF1ZXN0LnVzZXIgYXMgeyBzdWI6IHN0cmluZyB9O1xuICBjb25zdCB7IGlkIH0gPSByZXF1ZXN0LnBhcmFtcztcbiAgdHJ5IHtcbiAgICBhd2FpdCBkZWxldGVFbWVyZ2VuY3lDb250YWN0KHVzZXIuc3ViLCBpZCk7XG4gICAgcmV0dXJuIHJlcGx5LmNvZGUoMjA0KS5zZW5kKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHJlcGx5LmNvZGUoNDA0KS5zZW5kKHsgbWVzc2FnZTogJ0NvbnRhY3Qgbm90IGZvdW5kJyB9KTtcbiAgfVxufVxuIl19